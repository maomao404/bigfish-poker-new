<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BIGFISH POKER</title>
    <style>
        :root {
            --color-canvas-default: #ffffff;
            --color-canvas-subtle: #f6f8fa;
            --color-border-default: #d0d7de;
            --color-border-muted: #d8dee4;
            --color-accent-fg: #0969da;
            --color-accent-emphasis: #0969da;
            --color-danger-fg: #cf222e;
            --color-primer-shadow-inset: inset 0 1px 0 rgba(208,215,222,0.2);
            --color-primer-shadow-focus: 0 0 0 3px rgba(9,105,218,0.3);
            --color-fg-default: #24292f;
            --color-fg-muted: #57606a;
            --max-width-mobile: 100%;
            --max-width-desktop: 1000px;
            --padding-mobile: 12px;
            --padding-desktop: 20px;
        }

        body {
            max-width: var(--max-width-mobile);
            padding: var(--padding-mobile);
            margin: 0 auto;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
            line-height: 1.5;
            color: var(--color-fg-default);
            background-color: var(--color-canvas-subtle);
        }

        /* Logo 和标题样式 */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 16px auto;
            height: 40px;
        }

        .fish-logo {
            width: 32px;
            height: 32px;
            position: relative;
            transform: rotate(-45deg);
            display: inline-block;
        }

        .fish-body {
            width: 100%;
            height: 100%;
            background: var(--color-accent-fg);
            border-radius: 50% 50% 50% 0;
            position: relative;
            animation: swim 3s ease-in-out infinite;
        }

        .fish-tail {
            position: absolute;
            width: 40%;
            height: 40%;
            background: var(--color-accent-fg);
            bottom: -10%;
            right: -10%;
            border-radius: 50% 0 50% 50%;
            transform: rotate(45deg);
        }

        .fish-eye {
            position: absolute;
            width: 20%;
            height: 20%;
            background: white;
            border-radius: 50%;
            top: 30%;
            left: 30%;
            border: 2px solid var(--color-canvas-default);
        }

        @keyframes swim {
            0%, 100% {
                transform: rotate(-45deg) translateY(0);
            }
            50% {
                transform: rotate(-45deg) translateY(-5px);
            }
        }

        .site-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--color-accent-fg);
            margin: 0;
            padding: 0;
            line-height: 40px;
            display: inline-block;
            vertical-align: middle;
        }

        /* 结果显示样式 */
        .result-card {
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border-muted);
        }

        .result-title {
            color: var(--color-fg-default);
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .win-rate {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 16px;
        }

        .win-rate-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 8px solid var(--color-accent-fg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 600;
            color: var(--color-accent-fg);
            background: var(--color-canvas-subtle);
        }

        .win-rate-details {
            flex: 1;
        }

        .stat-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 6px;
            background: var(--color-canvas-subtle);
        }

        .stat-label {
            color: var(--color-fg-muted);
            font-size: 14px;
            margin-right: 16px;
            min-width: 100px;
        }

        .stat-value {
            color: var(--color-fg-default);
            font-weight: 600;
        }

        .stat-value.positive {
            color: var(--color-accent-fg);
        }

        .stat-value.negative {
            color: var(--color-danger-fg);
        }

        .progress-bar {
            height: 8px;
            background: var(--color-canvas-subtle);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-accent-fg);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* 图表容器样式 */
        .chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            margin: 20px auto;
            max-width: 800px;
        }

        .chart-wrapper {
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 0 auto;
            padding: 16px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* 底池赔率计算器样式 */
        .calculator-section {
            background-color: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            padding: 16px;
            margin-top: 24px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border-muted);
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-field label {
            color: var(--color-fg-muted);
            font-size: 14px;
            font-weight: 500;
        }

        .odds-result {
            background: var(--color-canvas-subtle);
            border-radius: 6px;
            padding: 16px;
            margin-top: 16px;
        }

        .odds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .odds-item {
            background: var(--color-canvas-default);
            border: 1px solid var(--color-border-muted);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        /* 牌选择器样式 */
        .card-selector-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            flex-wrap: nowrap;
        }

        .card-selector label {
            white-space: nowrap;
            font-size: 14px;
            color: var(--color-fg-muted);
            min-width: 70px;
        }

        .card-selector select {
            padding: 6px 12px;
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            background-color: var(--color-canvas-default);
            color: var(--color-fg-default);
            font-size: 14px;
            min-width: 80px;
        }

        /* 公共牌样式 */
        .community-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 16px;
        }

        .card-group {
            background: var(--color-canvas-subtle);
            padding: 16px;
            border-radius: 6px;
        }

        .card-group h4 {
            margin: 0 0 12px 0;
            color: var(--color-fg-muted);
            font-size: 14px;
            font-weight: 600;
        }

        .card-select {
            padding: 6px 10px;
            min-width: 70px;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .logo-container {
                height: 32px;
            }
            
            .fish-logo {
                width: 24px;
                height: 24px;
            }
            
            .site-title {
                font-size: 1.4rem;
                line-height: 32px;
            }

            .win-rate {
                flex-direction: column;
                align-items: center;
                gap: 16px;
            }

            .win-rate-circle {
                width: 100px;
                height: 100px;
                font-size: 20px;
                border-width: 6px;
            }

            .stat-item {
                padding: 6px;
            }

            .stat-label {
                min-width: 80px;
                font-size: 13px;
            }

            .card-selector {
                gap: 4px;
            }

            .card-selector label {
                min-width: 60px;
                font-size: 13px;
            }

            .card-selector select {
                padding: 6px 8px;
                min-width: 60px;
            }

            .chart-wrapper {
                height: 250px;
                padding: 12px;
            }
        }

        /* 暗色模式支持 */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-canvas-default: #0d1117;
                --color-canvas-subtle: #161b22;
                --color-border-default: #30363d;
                --color-border-muted: #21262d;
                --color-fg-default: #c9d1d9;
                --color-fg-muted: #8b949e;
                --color-accent-fg: #58a6ff;
            }

            body {
                background-color: var(--color-canvas-default);
                color: var(--color-fg-default);
            }
        }

        /* 按钮样式 */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .primary-button {
            background-color: var(--color-accent-fg);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .primary-button:hover {
            background-color: var(--color-accent-emphasis);
        }

        .secondary-button {
            background-color: var(--color-canvas-default);
            color: var(--color-fg-default);
            border: 1px solid var(--color-border-default);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .secondary-button:hover {
            background-color: var(--color-canvas-subtle);
        }

        /* 禁用状态 */
        .primary-button:disabled,
        .secondary-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .stats-card {
            background: var(--color-canvas-default);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
            padding: 16px;
        }

        .stats-card h4 {
            margin: 0 0 16px 0;
            color: var(--color-fg-default);
            font-size: 14px;
            font-weight: 600;
        }

        .stats-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stat-label {
            min-width: 80px;
            font-size: 13px;
            color: var(--color-fg-muted);
        }

        .stat-bar-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-bar {
            height: 8px;
            background: var(--color-accent-fg);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .stat-value {
            font-size: 13px;
            color: var(--color-fg-default);
            min-width: 40px;
            text-align: right;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .position-value {
            background: var(--color-canvas-subtle);
            border-radius: 6px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .position-label {
            font-size: 13px;
            color: var(--color-fg-muted);
        }

        .position-score {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-accent-fg);
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .position-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="logo-container">
        <div class="fish-logo">
            <div class="fish-body">
                <div class="fish-eye"></div>
                <div class="fish-tail"></div>
            </div>
        </div>
        <h1 class="site-title">BIGFISH POKER</h1>
    </div>

    <div class="calculator-section">
        <div class="section-header">
            <h3>手牌选择</h3>
        </div>
        
        <div class="card-selector-group">
            <!-- 手牌选择 -->
            <div class="card-selector">
                <label>第一张牌</label>
                <select id="card1Rank">
                    <option value="">选择点数</option>
                    <option value="A">A</option>
                    <option value="K">K</option>
                    <option value="Q">Q</option>
                    <option value="J">J</option>
                    <option value="T">10</option>
                    <option value="9">9</option>
                    <option value="8">8</option>
                    <option value="7">7</option>
                    <option value="6">6</option>
                    <option value="5">5</option>
                    <option value="4">4</option>
                    <option value="3">3</option>
                    <option value="2">2</option>
                </select>
                <select id="card1Suit">
                    <option value="">选择花色</option>
                    <option value="h">♥</option>
                    <option value="s">♠</option>
                    <option value="d">♦</option>
                    <option value="c">♣</option>
                </select>
            </div>

            <div class="card-selector">
                <label>第二张牌</label>
                <select id="card2Rank">
                    <option value="">选择点数</option>
                    <option value="A">A</option>
                    <option value="K">K</option>
                    <option value="Q">Q</option>
                    <option value="J">J</option>
                    <option value="T">10</option>
                    <option value="9">9</option>
                    <option value="8">8</option>
                    <option value="7">7</option>
                    <option value="6">6</option>
                    <option value="5">5</option>
                    <option value="4">4</option>
                    <option value="3">3</option>
                    <option value="2">2</option>
                </select>
                <select id="card2Suit">
                    <option value="">选择花色</option>
                    <option value="h">♥</option>
                    <option value="s">♠</option>
                    <option value="d">♦</option>
                    <option value="c">♣</option>
                </select>
            </div>
        </div>

        <!-- 公共牌选择 -->
        <div class="section-header">
            <h3>公共牌</h3>
        </div>
        
        <div class="community-cards">
            <div class="card-group">
                <h4>翻牌</h4>
                <div class="card-selector">
                    <select id="flop1Rank" class="card-select">
                        <option value="">点数</option>
                        <!-- 与上面相同的点数选项 -->
                    </select>
                    <select id="flop1Suit" class="card-select">
                        <option value="">花色</option>
                        <!-- 与上面相同的花色选项 -->
                    </select>
                </div>
                <div class="card-selector">
                    <select id="flop2Rank" class="card-select">
                        <option value="">点数</option>
                    </select>
                    <select id="flop2Suit" class="card-select">
                        <option value="">花色</option>
                    </select>
                </div>
                <div class="card-selector">
                    <select id="flop3Rank" class="card-select">
                        <option value="">点数</option>
                    </select>
                    <select id="flop3Suit" class="card-select">
                        <option value="">花色</option>
                    </select>
                </div>
            </div>
            
            <div class="card-group">
                <h4>转牌</h4>
                <div class="card-selector">
                    <select id="turnRank" class="card-select">
                        <option value="">点数</option>
                    </select>
                    <select id="turnSuit" class="card-select">
                        <option value="">花色</option>
                    </select>
                </div>
            </div>
            
            <div class="card-group">
                <h4>河牌</h4>
                <div class="card-selector">
                    <select id="riverRank" class="card-select">
                        <option value="">点数</option>
                    </select>
                    <select id="riverSuit" class="card-select">
                        <option value="">花色</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 在公共牌选择区域后添加胜率计算按钮和结果显示 -->
        <div class="action-buttons">
            <button id="calculateButton" class="primary-button" onclick="calculateEquity()">计算胜率</button>
            <button id="clearButton" class="secondary-button" onclick="clearCards()">清空选择</button>
        </div>
    </div>

    <div id="result" class="result-card">
        <div class="result-header">
            <h3 class="result-title">胜率分析结果</h3>
            <span class="stat-value">更新时间: <span id="updateTime"></span></span>
        </div>
        
        <div class="win-rate">
            <div class="win-rate-circle">
                <span id="mainWinRate">75%</span>
            </div>
            <div class="win-rate-details">
                <div class="stat-item">
                    <span class="stat-label">胜率</span>
                    <div style="flex: 1;">
                        <span class="stat-value positive">75%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 75%"></div>
                        </div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">平局概率</span>
                    <div style="flex: 1;">
                        <span class="stat-value">5%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 5%"></div>
                        </div>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">失败概率</span>
                    <div style="flex: 1;">
                        <span class="stat-value negative">20%</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 20%; background: var(--color-danger-fg)"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="stat-item">
            <span class="stat-label">建议操作</span>
            <span class="stat-value" id="suggestion">建议跟注，当前胜率较高</span>
        </div>
    </div>

    <div class="calculator-section">
        <div class="section-header">
            <h3>底池赔率计算器</h3>
        </div>
        
        <div class="input-group">
            <div class="input-field">
                <label for="potSize">当前底池</label>
                <input type="number" id="potSize" min="0" step="1">
            </div>
            <div class="input-field">
                <label for="betSize">需要跟注</label>
                <input type="number" id="betSize" min="0" step="1">
            </div>
        </div>
        
        <button onclick="calculatePotOdds()">计算赔率</button>
        
        <div id="oddsResult" class="odds-result" style="display: none;">
            <div class="odds-grid">
                <div class="odds-item">
                    <div class="odds-label">底池赔率</div>
                    <div class="odds-value" id="potOdds">--</div>
                </div>
                <div class="odds-item">
                    <div class="odds-label">所需胜率</div>
                    <div class="odds-value" id="requiredEquity">--</div>
                </div>
                <div class="odds-item">
                    <div class="odds-label">投资回报率</div>
                    <div class="odds-value" id="roi">--</div>
                </div>
            </div>
        </div>
    </div>

    <div class="calculator-section">
        <div class="section-header">
            <h3>对手范围分析</h3>
        </div>
        
        <div class="input-group">
            <div class="input-field">
                <label for="opponentPosition">对手位置</label>
                <select id="opponentPosition">
                    <option value="UTG">UTG</option>
                    <option value="MP">MP</option>
                    <option value="CO">CO</option>
                    <option value="BTN">BTN</option>
                    <option value="SB">SB</option>
                    <option value="BB">BB</option>
                </select>
            </div>
            <div class="input-field">
                <label for="opponentAction">对手行动</label>
                <select id="opponentAction">
                    <option value="raise">加注</option>
                    <option value="call">跟注</option>
                    <option value="3bet">3bet</option>
                    <option value="4bet">4bet</option>
                </select>
            </div>
            <div class="input-field">
                <label for="analyzeStreet">分析街道</label>
                <select id="analyzeStreet">
                    <option value="preflop">翻牌前</option>
                    <option value="flop">翻牌圈</option>
                    <option value="turn">转牌</option>
                    <option value="river">河牌</option>
                </select>
            </div>
        </div>
        
        <button onclick="analyzeOpponentRange()">分析范围</button>
        
        <div id="rangeAnalysisResult" class="odds-result" style="display: none;">
            <div class="range-summary">
                <div class="odds-item">
                    <div class="odds-label">预测范围强度</div>
                    <div class="odds-value" id="rangeStrength">--</div>
                </div>
                <div class="odds-item">
                    <div class="odds-label">关键牌型</div>
                    <div class="odds-value" id="keyHands">--</div>
                </div>
            </div>
            <div class="range-suggestion">
                <h4>策略建议</h4>
                <p id="rangeSuggestion">--</p>
            </div>
        </div>
    </div>

    <div class="calculator-section">
        <div class="section-header">
            <h3>牌型分布统计</h3>
        </div>
        
        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="handTypeChart"></canvas>
            </div>
        </div>
    </div>

    <div class="calculator-section">
        <div class="section-header">
            <h3>详细统计分析</h3>
        </div>

        <div class="stats-grid">
            <!-- 手牌分类 -->
            <div class="stats-card">
                <h4>手牌分类</h4>
                <div class="stats-content">
                    <div class="stat-row">
                        <span class="stat-label">高牌</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="highCardBar" style="width: 0%"></div>
                            <span class="stat-value" id="highCardValue">0%</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">成对</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="pairBar" style="width: 0%"></div>
                            <span class="stat-value" id="pairValue">0%</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">连牌</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="connectorBar" style="width: 0%"></div>
                            <span class="stat-value" id="connectorValue">0%</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">同花</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="suitedBar" style="width: 0%"></div>
                            <span class="stat-value" id="suitedValue">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 潜力分析 -->
            <div class="stats-card">
                <h4>成牌潜力</h4>
                <div class="stats-content">
                    <div class="stat-row">
                        <span class="stat-label">顺子潜力</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="straightDrawBar" style="width: 0%"></div>
                            <span class="stat-value" id="straightDrawValue">0%</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">同花潜力</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="flushDrawBar" style="width: 0%"></div>
                            <span class="stat-value" id="flushDrawValue">0%</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">超对潜力</span>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="overPairBar" style="width: 0%"></div>
                            <span class="stat-value" id="overPairValue">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 位置价值 -->
            <div class="stats-card">
                <h4>位置价值</h4>
                <div class="position-grid">
                    <div class="position-value" id="btnValue">
                        <span class="position-label">BTN</span>
                        <span class="position-score">85%</span>
                    </div>
                    <div class="position-value" id="coValue">
                        <span class="position-label">CO</span>
                        <span class="position-score">75%</span>
                    </div>
                    <div class="position-value" id="mpValue">
                        <span class="position-label">MP</span>
                        <span class="position-score">65%</span>
                    </div>
                    <div class="position-value" id="utgValue">
                        <span class="position-label">UTG</span>
                        <span class="position-score">55%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 底池赔率计算
        function calculatePotOdds() {
            const potSize = parseFloat(document.getElementById('potSize').value) || 0;
            const betSize = parseFloat(document.getElementById('betSize').value) || 0;
            
            if (potSize >= 0 && betSize > 0) {
                const odds = potSize / betSize;
                const requiredEquity = (betSize / (potSize + betSize)) * 100;
                const roi = (potSize / betSize) * 100;
                
                // 显示结果区域
                const oddsResult = document.getElementById('oddsResult');
                oddsResult.style.display = 'block';
                
                // 更新结果
                document.getElementById('potOdds').textContent = odds.toFixed(1) + ' : 1';
                document.getElementById('requiredEquity').textContent = requiredEquity.toFixed(1) + '%';
                document.getElementById('roi').textContent = roi.toFixed(0) + '%';
            }
        }

        // 对手范围分析功能
        function analyzeOpponentRange() {
            const position = document.getElementById('opponentPosition').value;
            const action = document.getElementById('opponentAction').value;
            const street = document.getElementById('analyzeStreet').value;
            
            // 显示结果区域
            const rangeResult = document.getElementById('rangeAnalysisResult');
            rangeResult.style.display = 'block';
            
            // 根据位置和行动获取范围强度
            const strength = getRangeStrength(position, action);
            const hands = getKeyHands(position, action);
            const suggestion = getStrategySuggestion(strength, street);
            
            // 更新显示
            document.getElementById('rangeStrength').textContent = strength + '%';
            document.getElementById('keyHands').textContent = hands;
            document.getElementById('rangeSuggestion').textContent = suggestion;
        }

        function getRangeStrength(position, action) {
            // 简化的范围强度计算
            const strengthMap = {
                'UTG': { 'raise': 85, 'call': 70, '3bet': 90, '4bet': 95 },
                'MP': { 'raise': 80, 'call': 65, '3bet': 88, '4bet': 93 },
                'CO': { 'raise': 75, 'call': 60, '3bet': 85, '4bet': 92 },
                'BTN': { 'raise': 70, 'call': 55, '3bet': 82, '4bet': 90 },
                'SB': { 'raise': 65, 'call': 50, '3bet': 80, '4bet': 88 },
                'BB': { 'raise': 60, 'call': 45, '3bet': 78, '4bet': 85 }
            };
            return strengthMap[position][action] || 75;
        }

        function getKeyHands(position, action) {
            // 简化的关键牌型
            const handsMap = {
                'UTG': { 
                    'raise': 'AA-TT, AK-AQ', 
                    'call': 'JJ-99, AJ-AT', 
                    '3bet': 'AA-QQ, AK', 
                    '4bet': 'AA-KK, AKs' 
                },
                'MP': { 
                    'raise': 'AA-99, AK-AJ', 
                    'call': 'TT-88, AJ-AT', 
                    '3bet': 'AA-JJ, AK-AQ', 
                    '4bet': 'AA-QQ, AK' 
                }
                // ... 其他位置的牌型可以根据需要添加
            };
            return handsMap[position]?.[action] || 'AA-TT, AK';
        }

        function getStrategySuggestion(strength, street) {
            if (strength > 90) {
                return '对手范围非常强，建议谨慎行动';
            } else if (strength > 80) {
                return '对手范围较强，可以考虑防守性打法';
            } else if (strength > 70) {
                return '对手范围中等，可以尝试探测性下注';
            } else {
                return '对手范围较弱，可以考虑积极进攻';
            }
        }

        // 牌型分布图表初始化
        let handTypeChart;
        function initHandTypeChart() {
            const ctx = document.getElementById('handTypeChart').getContext('2d');
            handTypeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['高牌', '对子', '两对', '三条', '顺子', '同花', '葫芦', '四条', '同花顺'],
                    datasets: [{
                        data: [30, 25, 15, 10, 8, 5, 4, 2, 1],
                        backgroundColor: [
                            '#0969da', '#1a7f37', '#cf222e', '#bf8700',
                            '#6639ba', '#ae2c00', '#1b7c83', '#8250df', '#57606a'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '牌型分布',
                            font: {
                                size: 14
                            }
                        },
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // 初始化所有牌选择器
        function initializeCardSelectors() {
            const ranks = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
            const suits = [
                {value: 'h', text: '♥'},
                {value: 's', text: '♠'},
                {value: 'd', text: '♦'},
                {value: 'c', text: '♣'}
            ];

            // 所有需要初始化的选择器
            const rankSelectors = [
                'flop1Rank', 'flop2Rank', 'flop3Rank',
                'turnRank', 'riverRank'
            ];

            const suitSelectors = [
                'flop1Suit', 'flop2Suit', 'flop3Suit',
                'turnSuit', 'riverSuit'
            ];

            // 初始化点数选择器
            rankSelectors.forEach(id => {
                const select = document.getElementById(id);
                ranks.forEach(rank => {
                    const option = document.createElement('option');
                    option.value = rank;
                    option.text = rank === 'T' ? '10' : rank;
                    select.appendChild(option);
                });
            });

            // 初始化花色选择器
            suitSelectors.forEach(id => {
                const select = document.getElementById(id);
                suits.forEach(suit => {
                    const option = document.createElement('option');
                    option.value = suit.value;
                    option.text = suit.text;
                    select.appendChild(option);
                });
            });
        }

        // 胜率计算函数
        function calculateEquity() {
            // 获取所有选择的牌
            const hand = getSelectedCards();
            
            // 验证选择
            if (!validateCardSelection(hand)) {
                alert('请选择有效的手牌');
                return;
            }

            // 更新胜率显示
            updateWinRate(calculateHandStrength(hand));

            // 更新统计分析
            updateStatistics(hand);
        }

        // 获取选择的牌
        function getSelectedCards() {
            return {
                hand: [
                    {
                        rank: document.getElementById('card1Rank').value,
                        suit: document.getElementById('card1Suit').value
                    },
                    {
                        rank: document.getElementById('card2Rank').value,
                        suit: document.getElementById('card2Suit').value
                    }
                ],
                board: [
                    {
                        rank: document.getElementById('flop1Rank').value,
                        suit: document.getElementById('flop1Suit').value
                    },
                    {
                        rank: document.getElementById('flop2Rank').value,
                        suit: document.getElementById('flop2Suit').value
                    },
                    {
                        rank: document.getElementById('flop3Rank').value,
                        suit: document.getElementById('flop3Suit').value
                    },
                    {
                        rank: document.getElementById('turnRank').value,
                        suit: document.getElementById('turnSuit').value
                    },
                    {
                        rank: document.getElementById('riverRank').value,
                        suit: document.getElementById('riverSuit').value
                    }
                ].filter(card => card.rank && card.suit) // 只保留已选择的牌
            };
        }

        // 验证牌的选择
        function validateCardSelection(hand) {
            // 检查手牌是否完整选择
            if (!hand.hand[0].rank || !hand.hand[0].suit || 
                !hand.hand[1].rank || !hand.hand[1].suit) {
                return false;
            }

            // 检查是否有重复的牌
            const allCards = [...hand.hand, ...hand.board];
            const cardStrings = allCards.map(card => card.rank + card.suit);
            return new Set(cardStrings).size === cardStrings.length;
        }

        // 计算手牌强度
        function calculateHandStrength(hand) {
            // 这里是简化的手牌强度计算逻辑
            // 实际应用中需要更复杂的算法
            let strength = 0;
            
            // 根据手牌类型计算基础强度
            if (hand.hand[0].rank === hand.hand[1].rank) {
                // 对子
                strength += 50;
            } else if (hand.hand[0].suit === hand.hand[1].suit) {
                // 同花可能
                strength += 30;
            }
            
            // 根据牌的大小调整强度
            const rankValues = {'A': 14, 'K': 13, 'Q': 12, 'J': 11, 'T': 10};
            const rank1 = rankValues[hand.hand[0].rank] || parseInt(hand.hand[0].rank);
            const rank2 = rankValues[hand.hand[1].rank] || parseInt(hand.hand[1].rank);
            
            strength += (rank1 + rank2) / 2;
            
            // 根据公共牌调整强度
            if (hand.board.length > 0) {
                // 这里添加更复杂的公共牌分析逻辑
                strength += analyzeBoard(hand.board, hand.hand);
            }
            
            // 将强度转换为百分比
            return Math.min(Math.max(Math.round(strength), 0), 100);
        }

        // 分析公共牌
        function analyzeBoard(board, hand) {
            // 简化的公共牌分析
            let bonus = 0;
            
            // 这里可以添加更复杂的公共牌分析逻辑
            // 比如检查顺子可能、同花可能等
            
            return bonus;
        }

        // 更新胜率显示
        function updateWinRate(strength) {
            document.getElementById('mainWinRate').textContent = strength + '%';
            
            // 更新进度条
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars[0].style.width = strength + '%';
            progressBars[1].style.width = (100 - strength) + '%';
            
            // 更新建议
            const suggestion = document.getElementById('suggestion');
            if (strength > 80) {
                suggestion.textContent = '手牌很强，建议积极进攻';
            } else if (strength > 60) {
                suggestion.textContent = '手牌不错，可以考虑下注';
            } else if (strength > 40) {
                suggestion.textContent = '手牌一般，谨慎行动';
            } else {
                suggestion.textContent = '手牌较弱，建议弃牌';
            }
        }

        // 清空选择
        function clearCards() {
            const selectors = [
                'card1Rank', 'card1Suit', 'card2Rank', 'card2Suit',
                'flop1Rank', 'flop1Suit', 'flop2Rank', 'flop2Suit',
                'flop3Rank', 'flop3Suit', 'turnRank', 'turnSuit',
                'riverRank', 'riverSuit'
            ];
            
            selectors.forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // 重置胜率显示
            document.getElementById('mainWinRate').textContent = '--';
            document.querySelectorAll('.progress-fill').forEach(bar => {
                bar.style.width = '0%';
            });
            document.getElementById('suggestion').textContent = '请选择手牌';
        }

        // 更新页面加载函数
        window.onload = function() {
            // 保留原有的初始化代码
            document.getElementById('potSize').addEventListener('input', function() {
                if (this.value < 0) this.value = 0;
            });
            
            document.getElementById('betSize').addEventListener('input', function() {
                if (this.value < 0) this.value = 0;
            });

            // 更新时间
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN');
            document.getElementById('updateTime').textContent = timeString;

            // 初始化牌型分布图表
            initHandTypeChart();

            // 初始化牌选择器
            initializeCardSelectors();
        };

        // 更新统计分析
        function updateStatistics(hand) {
            // 手牌分类统计
            const handStats = analyzeHandType(hand);
            updateStatBars(handStats);
            
            // 潜力分析
            const drawStats = analyzeDraws(hand);
            updateDrawBars(drawStats);
            
            // 位置价值
            updatePositionValues(hand);
        }

        // 分析手牌类型
        function analyzeHandType(hand) {
            const card1 = hand.hand[0];
            const card2 = hand.hand[1];
            
            return {
                highCard: isHighCard(card1, card2),
                pair: isPair(card1, card2),
                connector: isConnector(card1, card2),
                suited: isSuited(card1, card2)
            };
        }

        // 分析成牌潜力
        function analyzeDraws(hand) {
            return {
                straightDraw: calculateStraightDraw(hand),
                flushDraw: calculateFlushDraw(hand),
                overPair: calculateOverPair(hand)
            };
        }

        // 更新统计条
        function updateStatBars(stats) {
            Object.keys(stats).forEach(key => {
                const value = stats[key];
                const bar = document.getElementById(`${key}Bar`);
                const valueEl = document.getElementById(`${key}Value`);
                
                if (bar && valueEl) {
                    bar.style.width = `${value}%`;
                    valueEl.textContent = `${value}%`;
                }
            });
        }

        // 更新潜力条
        function updateDrawBars(stats) {
            Object.keys(stats).forEach(key => {
                const value = stats[key];
                const bar = document.getElementById(`${key}Bar`);
                const valueEl = document.getElementById(`${key}Value`);
                
                if (bar && valueEl) {
                    bar.style.width = `${value}%`;
                    valueEl.textContent = `${value}%`;
                }
            });
        }

        // 更新位置价值
        function updatePositionValues(hand) {
            const positions = ['btn', 'co', 'mp', 'utg'];
            const baseValues = {btn: 85, co: 75, mp: 65, utg: 55};
            
            positions.forEach(pos => {
                const valueEl = document.getElementById(`${pos}Value`);
                if (valueEl) {
                    const score = calculatePositionScore(hand, pos, baseValues[pos]);
                    valueEl.querySelector('.position-score').textContent = `${score}%`;
                }
            });
        }
    </script>
</body>
</html> 
